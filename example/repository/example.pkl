import "@ansipkl/AnsibleBuiltin.pkl"
import "@ansipkl/Playbook.pkl"

// sets up stuff...
todo_00_pb = new Listing<Playbook.Play> {
    new {
        name = "p0"
        hosts = "remote"
        remote_user = "root"

        roles {
            new { role = "docker" }

            new {
                role = "nginx_certbot"
                vars {
                    ["profile"] = "nginx_certbot_synapse"
                }
            }

            new {
                role = "nginx"
                vars {
                    ["profile"] = "nginx_synapse"
                }
            }

            new { role = "golang" }
        }
    }
}

todo_01_pb = new Listing<Playbook.Play> {
    new {
        name = "p1"
        hosts = "localhost:remote"
        remote_user = "root"

        roles {
            new {
                role = "sshUp"
                vars {
                    ["profile"] = "pipo_go_user"
                }
            }
        }
    }
}

todo_02_pb = new Listing<Playbook.Play> {
    new {
        name = "p2"
        hosts = "remote"
        remote_user = "pipo_go"

        tasks {
            new AnsibleBuiltin.Git {
                name = "clone pipo"
                options {
                    repo = "https://gitlab.com/brainpolice/pipo_go.git"
                    dest = "/home/pipo_go/pipo_go"
                    version = "{{ hostvars[inventory_hostname].pipo_go_version | default('master') }}"
                    update = true
                }
            }.into()

            new AnsibleBuiltin.Copy {
                name = "copy pipo.toml"
                options {
                    src = "../pipo.toml"
                    dest = "/home/pipo_go/pipo_go/pipo.toml"
                }
            }.into()
        }
    }
}

// todo_03_pb = new Listing<Playbook.Play> {
//     new {
//         name = "p3"
//         hosts = "remote"
//         remote_user = "root"
//
//         roles {
//             new {
//                 role = "nginx_certbot"
//                 vars {
//                     ["profile"] = "nginx_certbot_piposlack"
//                 }
//             }
//
//             new {
//                 role = "nginx"
//                 vars {
//                     ["profile"] = "nginx_piposlack"
//                 }
//             }
//         }
//     }
// }
